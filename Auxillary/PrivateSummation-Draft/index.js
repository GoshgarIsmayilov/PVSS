window.addEventListener('load', async () => {
    provider = new ethers.providers.Web3Provider(web3.currentProvider);

    await provider.send("eth_requestAccounts", []);

    $("#send-token-loader").hide();
    $("#receive-token-loader").hide();
});

var abi = JSON.parse('[{"inputs":[{"internalType":"uint256","name":"_registrationStartTime","type":"uint256"},{"internalType":"uint256","name":"_registrationTimeLimit","type":"uint256"}],"stateMutability":"nonpayable","type":"constructor"},{"inputs":[],"name":"calculateMaximumHypercubeStage","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"getAddressOfHypercubePair","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"getHypercubePair","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"getMyCommitment","outputs":[{"internalType":"uint256","name":"","type":"uint256"},{"internalType":"uint256","name":"","type":"uint256"},{"internalType":"uint256","name":"","type":"uint256"},{"internalType":"uint256","name":"","type":"uint256"},{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"getPublicKeyOfHypercubePair","outputs":[{"internalType":"string","name":"","type":"string"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"getSecretSumComponentsFromPair","outputs":[{"internalType":"string","name":"","type":"string"},{"internalType":"uint256","name":"","type":"uint256"},{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"commitment","type":"uint256"},{"internalType":"string","name":"publicKey","type":"string"}],"name":"register","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"string","name":"secretMessage","type":"string"}],"name":"submitSecretSumToPair","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256[2]","name":"a","type":"uint256[2]"},{"internalType":"uint256[2][2]","name":"b","type":"uint256[2][2]"},{"internalType":"uint256[2]","name":"c","type":"uint256[2]"},{"internalType":"uint256","name":"newSumCommitment","type":"uint256"}],"name":"verifyProof","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"nonpayable","type":"function"}]');

var bytecode = "608060405260006006556000600755600060085560006009556000600a553480156200002a57600080fd5b506040516200348e3803806200348e83398181016040528101906200005091906200007d565b81600881905550806009819055505050620000ed565b6000815190506200007781620000d3565b92915050565b60008060408385031215620000975762000096620000ce565b5b6000620000a78582860162000066565b9250506020620000ba8582860162000066565b9150509250929050565b6000819050919050565b600080fd5b620000de81620000c4565b8114620000ea57600080fd5b50565b61339180620000fd6000396000f3fe608060405234801561001057600080fd5b50600436106100935760003560e01c8063c2830b6c11610066578063c2830b6c1461010e578063cfd187e01461012c578063cfe0bf8b14610148578063fd10b5f11461016a578063ff43fce91461018857610093565b8063624c8f87146100985780638915b96f146100c85780638cf7c130146100e8578063a00fd3c8146100f2575b600080fd5b6100b260048036038101906100ad9190610e19565b6101a6565b6040516100bf91906111fd565b60405180910390f35b6100d0610558565b6040516100df9392919061123a565b60405180910390f35b6100f0610683565b005b61010c60048036038101906101079190610ef8565b6106c1565b005b61011661089e565b604051610123919061119b565b60405180910390f35b61014660048036038101906101419190610eaf565b6108f0565b005b6101506109d7565b6040516101619594939291906112d3565b60405180910390f35b610172610a79565b60405161017f91906112b8565b60405180910390f35b610190610acf565b60405161019d9190611218565b60405180910390f35b6000600654600754106101ee576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016101e590611278565b60405180910390fd5b60006101f861089e565b9050600060405161020890610bab565b604051809103906000f080158015610224573d6000803e3d6000fd5b50905060008173ffffffffffffffffffffffffffffffffffffffff1663aa2415228989896040518060800160405280600160003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020548152602001600160008b73ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000205481526020018b815260200160018152506040518563ffffffff1660e01b815260040161030794939291906111b6565b60206040518083038186803b15801561031f57600080fd5b505afa158015610333573d6000803e3d6000fd5b505050506040513d601f19601f820116820180604052508101906103579190610e82565b9050801561054a576001600a60008282546103729190611476565b92505081905550600580549050600a5414156103ab5760016007600082825461039b9190611476565b925050819055506000600a819055505b6000600360008573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002054141561043c5784600360003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002081905550610549565b84600160003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002081905550600360008473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002054600160008573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020819055506000600360008573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020819055505b5b809350505050949350505050565b6060600080600061056761089e565b9050600460008273ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000206006546007548280546105f7906116c7565b80601f0160208091040260200160405190810160405280929190818152602001828054610623906116c7565b80156106705780601f1061064557610100808354040283529160200191610670565b820191906000526020600020905b81548152906001019060200180831161065357829003601f168201915b5050505050925093509350935050909192565b60006006546002610694919061151f565b90508060058054905011156106be576001600660008282546106b69190611476565b925050819055505b50565b6000600260003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020805461070d906116c7565b90501461074f576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161074690611298565b60405180910390fd5b6005805490506000803373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000208190555081600160003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000208190555080600260003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020908051906020019061082e929190610bb8565b506005339080600181540180825580915050600190039060005260206000200160009091909190916101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff16021790555061089a610683565b5050565b6000806108a9610a79565b9050600581815481106108bf576108be611788565b5b9060005260206000200160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1691505090565b60065460075410610936576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161092d90611278565b60405180910390fd5b600061094061089e565b905081600460003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060008373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002090805190602001906109d2929190610bb8565b505050565b6000806000806000600160003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002054600360003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002054600754600654600a54945094509450945094509091929394565b60006007546002610a8a919061151f565b6000803373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000205418905090565b60606000610adb61089e565b9050600260008273ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000208054610b27906116c7565b80601f0160208091040260200160405190810160405280929190818152602001828054610b53906116c7565b8015610ba05780601f10610b7557610100808354040283529160200191610ba0565b820191906000526020600020905b815481529060010190602001808311610b8357829003601f168201915b505050505091505090565b611a98806118c483390190565b828054610bc4906116c7565b90600052602060002090601f016020900481019282610be65760008555610c2d565b82601f10610bff57805160ff1916838001178555610c2d565b82800160010185558215610c2d579182015b82811115610c2c578251825591602001919060010190610c11565b5b509050610c3a9190610c3e565b5090565b5b80821115610c57576000816000905550600101610c3f565b5090565b6000610c6e610c698461134b565b611326565b90508082856040860282011115610c8857610c876117eb565b5b60005b85811015610cb85781610c9e8882610d96565b845260208401935060408301925050600181019050610c8b565b5050509392505050565b6000610cd5610cd084611371565b611326565b90508082856020860282011115610cef57610cee6117eb565b5b60005b85811015610d1f5781610d058882610e04565b845260208401935060208301925050600181019050610cf2565b5050509392505050565b6000610d3c610d3784611397565b611326565b905082815260208101848484011115610d5857610d576117f0565b5b610d63848285611685565b509392505050565b600082601f830112610d8057610d7f6117e6565b5b6002610d8d848285610c5b565b91505092915050565b600082601f830112610dab57610daa6117e6565b5b6002610db8848285610cc2565b91505092915050565b600081519050610dd081611895565b92915050565b600082601f830112610deb57610dea6117e6565b5b8135610dfb848260208601610d29565b91505092915050565b600081359050610e13816118ac565b92915050565b6000806000806101208587031215610e3457610e336117fa565b5b6000610e4287828801610d96565b9450506040610e5387828801610d6b565b93505060c0610e6487828801610d96565b925050610100610e7687828801610e04565b91505092959194509250565b600060208284031215610e9857610e976117fa565b5b6000610ea684828501610dc1565b91505092915050565b600060208284031215610ec557610ec46117fa565b5b600082013567ffffffffffffffff811115610ee357610ee26117f5565b5b610eef84828501610dd6565b91505092915050565b60008060408385031215610f0f57610f0e6117fa565b5b6000610f1d85828601610e04565b925050602083013567ffffffffffffffff811115610f3e57610f3d6117f5565b5b610f4a85828601610dd6565b9150509250929050565b6000610f608383610fea565b60408301905092915050565b6000610f78838361117d565b60208301905092915050565b610f8d8161163d565b82525050565b610f9c816113e6565b610fa68184611439565b9250610fb1826113c8565b8060005b83811015610fe2578151610fc98782610f54565b9650610fd483611412565b925050600181019050610fb5565b505050505050565b610ff3816113f1565b610ffd8184611444565b9250611008826113d2565b8060005b838110156110395781516110208782610f6c565b965061102b8361141f565b92505060018101905061100c565b505050505050565b61104a816113f1565b611054818461144f565b925061105f826113d2565b8060005b838110156110905781516110778782610f6c565b96506110828361141f565b925050600181019050611063565b505050505050565b6110a1816113fc565b6110ab818461145a565b92506110b6826113dc565b8060005b838110156110e75781516110ce8782610f6c565b96506110d98361142c565b9250506001810190506110ba565b505050505050565b6110f88161164f565b82525050565b600061110982611407565b6111138185611465565b9350611123818560208601611694565b61112c816117ff565b840191505092915050565b6000611144602583611465565b915061114f8261181d565b604082019050919050565b6000611167601c83611465565b91506111728261186c565b602082019050919050565b6111868161167b565b82525050565b6111958161167b565b82525050565b60006020820190506111b06000830184610f84565b92915050565b6000610180820190506111cc6000830187611041565b6111d96040830186610f93565b6111e660c0830185611041565b6111f4610100830184611098565b95945050505050565b600060208201905061121260008301846110ef565b92915050565b6000602082019050818103600083015261123281846110fe565b905092915050565b6000606082019050818103600083015261125481866110fe565b9050611263602083018561118c565b611270604083018461118c565b949350505050565b6000602082019050818103600083015261129181611137565b9050919050565b600060208201905081810360008301526112b18161115a565b9050919050565b60006020820190506112cd600083018461118c565b92915050565b600060a0820190506112e8600083018861118c565b6112f5602083018761118c565b611302604083018661118c565b61130f606083018561118c565b61131c608083018461118c565b9695505050505050565b6000611330611341565b905061133c82826116f9565b919050565b6000604051905090565b600067ffffffffffffffff821115611366576113656117b7565b5b602082029050919050565b600067ffffffffffffffff82111561138c5761138b6117b7565b5b602082029050919050565b600067ffffffffffffffff8211156113b2576113b16117b7565b5b6113bb826117ff565b9050602081019050919050565b6000819050919050565b6000819050919050565b6000819050919050565b600060029050919050565b600060029050919050565b600060049050919050565b600081519050919050565b6000602082019050919050565b6000602082019050919050565b6000602082019050919050565b600081905092915050565b600081905092915050565b600081905092915050565b600081905092915050565b600082825260208201905092915050565b60006114818261167b565b915061148c8361167b565b9250827fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff038211156114c1576114c061172a565b5b828201905092915050565b6000808291508390505b6001851115611516578086048111156114f2576114f161172a565b5b60018516156115015780820291505b808102905061150f85611810565b94506114d6565b94509492505050565b600061152a8261167b565b91506115358361167b565b92506115627fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff848461156a565b905092915050565b60008261157a5760019050611636565b816115885760009050611636565b816001811461159e57600281146115a8576115d7565b6001915050611636565b60ff8411156115ba576115b961172a565b5b8360020a9150848211156115d1576115d061172a565b5b50611636565b5060208310610133831016604e8410600b841016171561160c5782820a9050838111156116075761160661172a565b5b611636565b61161984848460016114cc565b925090508184048111156116305761162f61172a565b5b81810290505b9392505050565b60006116488261165b565b9050919050565b60008115159050919050565b600073ffffffffffffffffffffffffffffffffffffffff82169050919050565b6000819050919050565b82818337600083830152505050565b60005b838110156116b2578082015181840152602081019050611697565b838111156116c1576000848401525b50505050565b600060028204905060018216806116df57607f821691505b602082108114156116f3576116f2611759565b5b50919050565b611702826117ff565b810181811067ffffffffffffffff82111715611721576117206117b7565b5b80604052505050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052601160045260246000fd5b7f4e487b7100000000000000000000000000000000000000000000000000000000600052602260045260246000fd5b7f4e487b7100000000000000000000000000000000000000000000000000000000600052603260045260246000fd5b7f4e487b7100000000000000000000000000000000000000000000000000000000600052604160045260246000fd5b600080fd5b600080fd5b600080fd5b600080fd5b600080fd5b6000601f19601f8301169050919050565b60008160011c9050919050565b7f4f6e6c7920616c6c6f77656420647572696e672068797065726375626520706560008201527f72696f6421000000000000000000000000000000000000000000000000000000602082015250565b7f557365722068617320616c726561647920726567697374657265642100000000600082015250565b61189e8161164f565b81146118a957600080fd5b50565b6118b58161167b565b81146118c057600080fd5b5056fe608060405234801561001057600080fd5b50611a78806100206000396000f3fe608060405234801561001057600080fd5b50600436106100365760003560e01c8063799afa761461003b578063aa2415221461006b575b600080fd5b610055600480360381019061005091906116a2565b61009b565b60405161006291906116f3565b60405180910390f35b61008560048036038101906100809190611639565b610169565b60405161009291906116f3565b60405180910390f35b600080600467ffffffffffffffff8111156100b9576100b86119d7565b5b6040519080825280602002602001820160405280156100e75781602001602082028036833780820191505090505b50905060005b600481101561014057838160048110610109576101086119a8565b5b6020020151828281518110610121576101206119a8565b5b6020026020010181815250508080610138906118d0565b9150506100ed565b50600061014d82866103e3565b141561015d576001915050610163565b60009150505b92915050565b6000610173611227565b604051806040016040528087600060028110610192576101916119a8565b5b60200201518152602001876001600281106101b0576101af6119a8565b5b6020020151815250816000018190525060405180604001604052806040518060400160405280886000600281106101ea576101e96119a8565b5b6020020151600060028110610202576102016119a8565b5b60200201518152602001886000600281106102205761021f6119a8565b5b6020020151600160028110610238576102376119a8565b5b60200201518152508152602001604051806040016040528088600160028110610264576102636119a8565b5b602002015160006002811061027c5761027b6119a8565b5b602002015181526020018860016002811061029a576102996119a8565b5b60200201516001600281106102b2576102b16119a8565b5b602002015181525081525081602001819052506040518060400160405280856000600281106102e4576102e36119a8565b5b6020020151815260200185600160028110610302576103016119a8565b5b602002015181525081604001819052506000600467ffffffffffffffff81111561032f5761032e6119d7565b5b60405190808252806020026020018201604052801561035d5781602001602082028036833780820191505090505b50905060005b60048110156103b65784816004811061037f5761037e6119a8565b5b6020020151828281518110610397576103966119a8565b5b60200260200101818152505080806103ae906118d0565b915050610363565b5060006103c382846103e3565b14156103d4576001925050506103db565b6000925050505b949350505050565b6000807f30644e72e131a029b85045b68181585d2833e84879b9709143e1f593f00000019050600061041361057a565b90508060800151516001865161042991906117a5565b1461043357600080fd5b60006040518060400160405280600081526020016000815250905060005b86518110156104ec578387828151811061046e5761046d6119a8565b5b60200260200101511061048057600080fd5b6104d7826104d2856080015160018561049991906117a5565b815181106104aa576104a96119a8565b5b60200260200101518a85815181106104c5576104c46119a8565b5b6020026020010151610ae6565b610b8d565b915080806104e4906118d0565b915050610451565b50610516818360800151600081518110610509576105086119a8565b5b6020026020010151610b8d565b905061055c8560000151866020015161052e84610c5a565b85604001516105408a60400151610c5a565b87606001516105528960000151610c5a565b8960200151610cff565b61056c5760019350505050610574565b600093505050505b92915050565b61058261125a565b60405180604001604052807f075283a39b751736524127064cb7e3e97f0b793e9d2c77622c735290dd4f114381526020017f037bc91f58c2cf5885d6003dab5b4c5893358e10c2adb9e4dc3d91984769640b8152508160000181905250604051806040016040528060405180604001604052807f236e14c78c52483c5ddf4102bdec26cd995ccae9f26e24cbbbf9c1d646c35f5e81526020017f136629cff10743d59d656abe093b2f4fcacb3bedd79ae523e68df9e3620c6358815250815260200160405180604001604052807f2f17e7f2e102002ba714e9f24f02b0ed7603fb260355322f5d611ba770b22e7d81526020017f2679c40107948f17e2bb370a580ce29cea64121840db276568af0c405030b9608152508152508160200181905250604051806040016040528060405180604001604052807f1a1998366d538c4252e4a005b63b13954dea35c39f3a65e4a8d479216764e0bd81526020017f051faed11e1614956a4d1109e836bcedc35bc7317f43d6b69bafd5fe5c47baee815250815260200160405180604001604052807f1a943f9993622a0783a1be5b452d04ba0971641067d39c4e958a59581f92727081526020017f03073b84b810092f9287e89f9b10fe20415226a16d50185af16f3ba6f25e91e68152508152508160400181905250604051806040016040528060405180604001604052807f139119cf2583ac35225315b8cb540e8054f56bda98891f5d07f1a2ea5a0ae9bb81526020017f2636c4157fa712f0f0420545759caa323184f38c9b7be794b62a53a8932304cf815250815260200160405180604001604052807f1e3e8528341c3236be0896599b65ce9a9188327f726f5193ce2924ff3c6917d381526020017f27c7ec8241daa2e58f88169eda23d77c119599f91eaa77fc93ce0c42664adb7e8152508152508160600181905250600567ffffffffffffffff811115610849576108486119d7565b5b60405190808252806020026020018201604052801561088257816020015b61086f6112a1565b8152602001906001900390816108675790505b50816080018190525060405180604001604052807f08d5e198ca247dcde54ef77ac8e766036cdea4f18ff58cca3c484170364c6c0c81526020017f23415619f3c23074d8656fb94e4f2f46f7cb3f36e6adbb5f072511f3da4eb7f981525081608001516000815181106108f8576108f76119a8565b5b602002602001018190525060405180604001604052807f245e24081ffbde486fcbc9366d92f9c62fd18413a70be1ef17070513931a0f4381526020017f2aab2278b84bd5fa1e722c2d9bb087c1398500b712d8dc67896938706fa2265381525081608001516001815181106109705761096f6119a8565b5b602002602001018190525060405180604001604052807f02e4218f9e62b0c78e55ebb9b5e275ef7eeeedc29d34fa3bafdb2f339862c23581526020017f1ec21074c8ad9db7469eb18f4ce613d989f305c038759c0bd3beb2dea5cad30081525081608001516002815181106109e8576109e76119a8565b5b602002602001018190525060405180604001604052807f07a3220fa44ded408a4e21a595e0032269deb6c5ad598f1d4cdaa969196fd8d281526020017f075aa2d7bba8c0940fc349c6e1da97cb0255cbe6c87068e42afc637f124055798152508160800151600381518110610a6057610a5f6119a8565b5b602002602001018190525060405180604001604052807f226ed6eef7bf7aa8d5326aa2e97a85184eb20c1a2dd3ecb9b6197b0df576754081526020017f0b32c54590a650291ecc0f7f13065a0b89177f68c637869ef1a0bd4d03fa268c8152508160800151600481518110610ad857610ad76119a8565b5b602002602001018190525090565b610aee6112a1565b610af66112bb565b836000015181600060038110610b0f57610b0e6119a8565b5b602002018181525050836020015181600160038110610b3157610b306119a8565b5b6020020181815250508281600260038110610b4f57610b4e6119a8565b5b602002018181525050600060608360808460076107d05a03fa90508060008114610b7857610b7a565bfe5b5080610b8557600080fd5b505092915050565b610b956112a1565b610b9d6112dd565b836000015181600060048110610bb657610bb56119a8565b5b602002018181525050836020015181600160048110610bd857610bd76119a8565b5b602002018181525050826000015181600260048110610bfa57610bf96119a8565b5b602002018181525050826020015181600360048110610c1c57610c1b6119a8565b5b602002018181525050600060608360c08460066107d05a03fa90508060008114610c4557610c47565bfe5b5080610c5257600080fd5b505092915050565b610c626112a1565b60007f30644e72e131a029b85045b68181585d97816a916871ca8d3c208c16d87cfd47905060008360000151148015610c9f575060008360200151145b15610cc3576040518060400160405280600081526020016000815250915050610cfa565b604051806040016040528084600001518152602001828560200151610ce89190611919565b83610cf39190611855565b8152509150505b919050565b600080600467ffffffffffffffff811115610d1d57610d1c6119d7565b5b604051908082528060200260200182016040528015610d5657816020015b610d436112a1565b815260200190600190039081610d3b5790505b5090506000600467ffffffffffffffff811115610d7657610d756119d7565b5b604051908082528060200260200182016040528015610daf57816020015b610d9c6112ff565b815260200190600190039081610d945790505b5090508a82600081518110610dc757610dc66119a8565b5b60200260200101819052508882600181518110610de757610de66119a8565b5b60200260200101819052508682600281518110610e0757610e066119a8565b5b60200260200101819052508482600381518110610e2757610e266119a8565b5b60200260200101819052508981600081518110610e4757610e466119a8565b5b60200260200101819052508781600181518110610e6757610e666119a8565b5b60200260200101819052508581600281518110610e8757610e866119a8565b5b60200260200101819052508381600381518110610ea757610ea66119a8565b5b6020026020010181905250610ebc8282610ecc565b9250505098975050505050505050565b60008151835114610edc57600080fd5b6000835190506000600682610ef191906117fb565b905060008167ffffffffffffffff811115610f0f57610f0e6119d7565b5b604051908082528060200260200182016040528015610f3d5781602001602082028036833780820191505090505b50905060005b838110156111c257868181518110610f5e57610f5d6119a8565b5b602002602001015160000151826000600684610f7a91906117fb565b610f8491906117a5565b81518110610f9557610f946119a8565b5b602002602001018181525050868181518110610fb457610fb36119a8565b5b602002602001015160200151826001600684610fd091906117fb565b610fda91906117a5565b81518110610feb57610fea6119a8565b5b60200260200101818152505085818151811061100a576110096119a8565b5b602002602001015160000151600160028110611029576110286119a8565b5b602002015182600260068461103e91906117fb565b61104891906117a5565b81518110611059576110586119a8565b5b602002602001018181525050858181518110611078576110776119a8565b5b602002602001015160000151600060028110611097576110966119a8565b5b60200201518260036006846110ac91906117fb565b6110b691906117a5565b815181106110c7576110c66119a8565b5b6020026020010181815250508581815181106110e6576110e56119a8565b5b602002602001015160200151600160028110611105576111046119a8565b5b602002015182600460068461111a91906117fb565b61112491906117a5565b81518110611135576111346119a8565b5b602002602001018181525050858181518110611154576111536119a8565b5b602002602001015160200151600060028110611173576111726119a8565b5b602002015182600560068461118891906117fb565b61119291906117a5565b815181106111a3576111a26119a8565b5b60200260200101818152505080806111ba906118d0565b915050610f43565b506111cb611325565b6000602082602086026020860160086107d05a03fa905080600081146111f0576111f2565bfe5b50806111fd57600080fd5b600082600060018110611213576112126119a8565b5b602002015114159550505050505092915050565b604051806060016040528061123a6112a1565b81526020016112476112ff565b81526020016112546112a1565b81525090565b6040518060a0016040528061126d6112a1565b815260200161127a6112ff565b81526020016112876112ff565b81526020016112946112ff565b8152602001606081525090565b604051806040016040528060008152602001600081525090565b6040518060600160405280600390602082028036833780820191505090505090565b6040518060800160405280600490602082028036833780820191505090505090565b6040518060400160405280611312611347565b815260200161131f611347565b81525090565b6040518060200160405280600190602082028036833780820191505090505090565b6040518060400160405280600290602082028036833780820191505090505090565b600061137c61137784611733565b61170e565b9050808285604086028201111561139657611395611a10565b5b60005b858110156113c657816113ac88826114c9565b845260208401935060408301925050600181019050611399565b5050509392505050565b60006113e36113de84611759565b61170e565b905080828560208602820111156113fd576113fc611a10565b5b60005b8581101561142d57816114138882611624565b845260208401935060208301925050600181019050611400565b5050509392505050565b600061144a6114458461177f565b61170e565b9050808285602086028201111561146457611463611a10565b5b60005b85811015611494578161147a8882611624565b845260208401935060208301925050600181019050611467565b5050509392505050565b600082601f8301126114b3576114b2611a06565b5b60026114c0848285611369565b91505092915050565b600082601f8301126114de576114dd611a06565b5b60026114eb8482856113d0565b91505092915050565b600082601f83011261150957611508611a06565b5b6004611516848285611437565b91505092915050565b60006040828403121561153557611534611a0b565b5b61153f604061170e565b9050600061154f84828501611624565b600083015250602061156384828501611624565b60208301525092915050565b60006080828403121561158557611584611a0b565b5b61158f604061170e565b9050600061159f848285016114c9565b60008301525060406115b3848285016114c9565b60208301525092915050565b600061010082840312156115d6576115d5611a0b565b5b6115e0606061170e565b905060006115f08482850161151f565b60008301525060406116048482850161156f565b60208301525060c06116188482850161151f565b60408301525092915050565b60008135905061163381611a2b565b92915050565b600080600080610180858703121561165457611653611a15565b5b6000611662878288016114c9565b94505060406116738782880161149e565b93505060c0611684878288016114c9565b925050610100611696878288016114f4565b91505092959194509250565b60008061018083850312156116ba576116b9611a15565b5b60006116c8858286016115bf565b9250506101006116da858286016114f4565b9150509250929050565b6116ed81611889565b82525050565b600060208201905061170860008301846116e4565b92915050565b6000611718611729565b9050611724828261189f565b919050565b6000604051905090565b600067ffffffffffffffff82111561174e5761174d6119d7565b5b602082029050919050565b600067ffffffffffffffff821115611774576117736119d7565b5b602082029050919050565b600067ffffffffffffffff82111561179a576117996119d7565b5b602082029050919050565b60006117b082611895565b91506117bb83611895565b9250827fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff038211156117f0576117ef61194a565b5b828201905092915050565b600061180682611895565b915061181183611895565b9250817fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff048311821515161561184a5761184961194a565b5b828202905092915050565b600061186082611895565b915061186b83611895565b92508282101561187e5761187d61194a565b5b828203905092915050565b60008115159050919050565b6000819050919050565b6118a882611a1a565b810181811067ffffffffffffffff821117156118c7576118c66119d7565b5b80604052505050565b60006118db82611895565b91507fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff82141561190e5761190d61194a565b5b600182019050919050565b600061192482611895565b915061192f83611895565b92508261193f5761193e611979565b5b828206905092915050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052601160045260246000fd5b7f4e487b7100000000000000000000000000000000000000000000000000000000600052601260045260246000fd5b7f4e487b7100000000000000000000000000000000000000000000000000000000600052603260045260246000fd5b7f4e487b7100000000000000000000000000000000000000000000000000000000600052604160045260246000fd5b600080fd5b600080fd5b600080fd5b600080fd5b6000601f19601f8301169050919050565b611a3481611895565b8114611a3f57600080fd5b5056fea264697066735822122008a9bb059d52e842c52cd8e6ffd4cfae7de2f077a6ac584e0d170b770df6024a64736f6c63430008070033a26469706673582212207a958a540d58b4b94e47bb007632b38c799748b94d71333c8f8a0ab125bdd97164736f6c63430008070033";
    
async function deploy_contract() {
    let registration_start_time = $("#registration-start-time").val();
    let registration_time_limit = $("#registration-time-limit").val();

    let signer = provider.getSigner(0);
    let factory = new ethers.ContractFactory(abi, bytecode, signer);
    let contract = await factory.deploy(String(registration_start_time), String(registration_time_limit));

    $("#status-deploy-contract").html('<b style="color:green;">The contract is deployed with the address: ' + contract.address + '</b>');
}

async function register() {
    let contract_address = $("#register-contract-address").val();
    let secret_value = $("#register-secret-value").val();

    let signer = provider.getSigner(0);
    let contract = new ethers.Contract(String(contract_address), abi, signer);

    const register_signer = provider.getSigner()
    const ethereum_address = await register_signer.getAddress()
    const hash = await ethers.utils.keccak256(ethereum_address)
    const signature = await signer.signMessage(ethers.utils.arrayify(hash))
    const public_key = ethers.utils.recoverPublicKey(ethers.utils.arrayify(ethers.utils.hashMessage(ethers.utils.arrayify(hash))), signature);

    let secure_number = 0; // Math.floor(Math.random() * Number.MAX_SAFE_INTEGER); 

    console.log(secret_value);
    console.log(secure_number);

    let commitment = await zokrates_hash(String(secret_value), String(secure_number));
    commitment = JSON.parse(commitment);

    console.log(commitment);

    let transaction = await contract.register(String(commitment), String(public_key));
    
    $("#status-register").html('<b style="color:green;">You have registered with the transaction: ' + transaction.hash + 
                                                   '<br>Secret value is ' + secret_value + ' and secure number is ' + secure_number +
                                                   '<br>Record secret value and secure number to involve with private summation. </b>');
}

async function submit() {
    let contract_address = $("#submit-contract-address").val();
    let secret_sum = $("#submit-secret-sum").val();
    let secure_number = $("#submit-secure-number").val();

    let signer = provider.getSigner(0);
    let contract = new ethers.Contract(String(contract_address), abi, signer);

    let public_key = await contract.getPublicKeyOfHypercubePair();
    let ciphertext = await encrypt(public_key.substr(2), String(secret_sum) + " " + String(secure_number)); 

    console.log(public_key);

    let transaction = await contract.submitSecretSumToPair(String(ciphertext));

    $("#status-submit").html('<b style="color:green;">You have submitted secret sum with the transaction: ' + transaction.hash);
}

async function verify() {
    let contract_address = $("#verify-contract-address").val();
    let secret_sum = $("#verify-secret-sum").val();
    let secure_number = $("#verify-secure-number").val();
    let private_key = $("#verify-private-key").val();

    let signer = provider.getSigner(0);
    let contract = new ethers.Contract(String(contract_address), abi, signer);

    let [encodedSecretSum, maximumHypercubeStage, currentHypercubeStage] = await contract.getSecretSumComponentsFromPair();

    let plaintext = await decrypt(private_key, encodedSecretSum);
    let secret_sum_pair = parseInt(plaintext.split(" ")[0]);
    let secure_number_pair = parseInt(plaintext.split(" ")[1]);

    let new_secret_sum = parseInt(secret_sum) + parseInt(secret_sum_pair); 
    let new_secure_number = 0; // Math.floor(Math.random() * Number.MAX_SAFE_INTEGER);
    
    let my_commitment = await zokrates_hash(String(secret_sum), String(secure_number));
    my_commitment = JSON.parse(my_commitment);
    let pair_commitment = await zokrates_hash(String(secret_sum_pair), String(secure_number_pair));
    pair_commitment = JSON.parse(pair_commitment);
    let new_commitment = await zokrates_hash(String(new_secret_sum), String(new_secure_number));
    new_commitment = JSON.parse(new_commitment);

    console.log(secret_sum);
    console.log(secure_number);
    console.log(new_secure_number);
    console.log(secret_sum_pair);
    console.log(secure_number_pair);
    console.log(my_commitment);
    console.log(pair_commitment);
    console.log(new_commitment);

    console.time('Proof Generation Time')

    let proof = await zokrates_sender_proof(String(secret_sum), String(secure_number), String(new_secure_number), String(secret_sum_pair), String(secure_number_pair), String(my_commitment), String(pair_commitment), String(new_commitment));

    console.timeEnd('Proof Generation Time')

    console.log(proof.proof.a);
    console.log(proof.proof.b);
    console.log(proof.proof.c);
    console.log(proof.inputs);

    let transaction = await contract.verifyProof(proof.proof.a, proof.proof.b, proof.proof.c, String(new_commitment));

    if (Number(currentHypercubeStage) + 1 == Number(maximumHypercubeStage)) {
        $("#status-verify").html('<b style="color:green;">You have verified with the transaction: ' + transaction.hash + 
        '<br>Congratulations! Final sum is ' + new_secret_sum);
    }
    else {
        $("#status-verify").html('<b style="color:green;">You have verified with the transaction: ' + transaction.hash + 
        '<br>Secret sum is ' + new_secret_sum + ' and secure number is ' + new_secure_number +
        '<br>Record secret sum and secure number to involve with private summation. </b>');
    }
}